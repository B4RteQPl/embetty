language: node_js
node_js:
- '8'
- '10'
dist: trusty
sudo: required
addons:
  chrome: stable
  apt:
    packages:
      - p7zip-full
env:
  global:
    - BASE_NAME=embetty-$TRAVIS_TAG
cache:
  yarn: true
  directories:
    - node_modules
matrix:
  allow_failures:
    - node_js: 10
script:
- yarn test
- yarn build
before_install: yarn global add greenkeeper-lockfile@1
before_script: greenkeeper-lockfile-update
before_deploy: yarn build:zip
after_script: greenkeeper-lockfile-upload
deploy:
  - provider: npm
    skip_cleanup: true
    provider: npm
    email: npmjs@heise.de
    api_key:
      secure: "Zj6tLHrPNZWZS10KdB5Yefii3bW66s6Jkmds2i/lo4+cWmdW0ykN2yT6OdU3SwR7wz56JwtwYaV4grkGwqTDtldOEiuQzjVHqV/W0yFBU7NAsceWqf4WpqT6I8lo+a7/20oKRHXxmxw1deUn/u7xBWJUcy29VGLG1ShHCXvXLmOYYU4qRsCh80V7ou5/KTqkqPRi7VnpYcEq6IJP3I0WtF/plSCfx8or14Znvt0gYPBeaZxpZwUeIW7YK++pf6HcIrKpEoxiaGCcF9954e2nukyP0Fe6D0Dn5mawxx7q92aNy0GK4nU7KhRSOO5OH/py4VKiVTCmLbdvCMrbBo+mXpw97p5sMx2PhsM7CBX3MAhMZud9ZlX3PGksiT3+APEBos0auxlmxoSYqrIkJIomh5ZwgYrA8r+KFvjZ7f7wUonD9rxycS2Fz017allcQdNbjjg5oYWsBZNO/jvVnhOM9SSj+bft87KYQA6i6kdxHwHDqkgzoU0cqqQqCPQU6KpuZzTFdb3koL+8pOOeRfwfNFUOcBKoKoWdvMME8zVdvMeBcOoEQRO5mC7fp3SY19gORD2IkLOh6JrM2pTMM4NIUgl0V0A+qm1DEYyY+ixkHwNu5Jb0yyXb2YuoUQOnYZH/CqWOLuJxC7Sif0apw4qU8IuKj2EBMzEp0KJskQxqyY4="
    on:
      tags: true
      repo: heiseonline/embetty
      node_js: '8'
  - provider: releases
    api_key:
      secure: "L60l7vyNfWmyEvLhVSY4EKb3Y61Sq0VVBinmZOEIGf4lYPGaFKiOZOgVOiIe9juvB2kJ5meyHkEstdnWaarTAmzufnjW1SO55Q9bF/ZZ2N7l0q2+7Gh57H5Wp+DFwslD8ymOQdI/0xtoOlXkxDCOCwaw2esJpqRxNR2MfEkGis54/uUaahyx6zsXWvzzefpxIB/uZjOFdklqJVxHfvyYDSK8oHAHGbdNaqpf761FyV9tcnGQ2oMSzR+oI9sg8CXQABiGaJKsFjmJF2XuzwG3blCxpk3e8E1aucxsqnd7pq0rloPM+AQgFBhnBh4rtUMmQ1w7hmCRZPXc9bpg08XNbRmd5YOiHuFrF3cvdTQMAjW0jT1H/DlpwteKy4BYn8ucG+H3bxjnjh1M2zjUXuvzrdqJQM+6DdkJ7/x0T4nlcLVCUSKNfOuc7rvCc3HJZ8206yRKItGj9m/hEPFwNic05WLNDwkUwr59RR6qSogycNDL976mgGwqaR1Pi/W7KalcSQjfIT6lxcHYUgQvpmnLs1VAX6xjPy1soDwGK8BZ24ZS3Ou+enYEhzS5svCJrwmWM6ian+CP08YooCIxOdfd2yM+R2yAxeJ+butZQRHmOtrxjg6xdjDcjrdGsgwN2OB3ruRwhAc0ZN6yj85RrvxutMMpx3LDgklwkXd7nVHgZNA="
    file:
      - $BASE_NAME.zip
      - $BASE_NAME.tar.gz
    skip_cleanup: true
    on:
      tags: true
      repo: heiseonline/embetty
      node_js: '8'
